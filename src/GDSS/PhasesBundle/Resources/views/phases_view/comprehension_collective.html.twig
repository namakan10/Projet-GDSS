{% extends '@GDSSPlatform/layoutGDSS.html.twig' %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('bundles/gdssplatform/css/mui.min.css') }}" type="text/css">
    <link rel="stylesheet" href="{{ asset('bundles/gdssplatform/css/bootstrap.min.css') }}" type="text/css">
    <link rel="stylesheet" href="{{ asset('bundles/gdssplatform/css/general.css') }}" type="text/css">
    <link rel="stylesheet" href="{{ asset('bundles/gdssphases/css/chat.css') }}" type="text/css">
    <link rel="stylesheet" href="{{ asset('bundles/gdssphases/css/timer.css') }}" type="text/css">
    {% block customstylesheets %}
    {% endblock %}
{% endblock %}

{% block title %}Comprehension collective{% endblock %}


{% block curentSujet %}active{% endblock %}
{% block body %}

    {% block subtitle %}
        <h1 style="text-decoration-style: double; margin-left: -170px"><a class="fas fa-arrow-left" href="{{ path('problem', {'id' : id}) }}"> </a> Comprehension Collective</h1>
    {% endblock %}

    <div class="noti"></div>

    <div class="" style="width: 1000px; margin-left: 50px">
        {% if finish %}
            <div id = "test" class="divscript" style="border: 2px groove; border-radius: 10px; height: 350px; background-color: white; overflow: scroll;">
                {% block controller1 %}
                    {{ render(controller('GDSSPhasesBundle:View:scriptCCP', {'id' : id} )) }}
                {% endblock %}
            </div>
            <br/>
        {% else %}
            <div id = "test" class="divscript" style="border: 2px groove; border-radius: 10px; height: 340px; background-color: white; overflow: scroll; margin-top: 20px">

                {% block controller2 %}
                    {{ render(controller('GDSSPhasesBundle:View:scriptCCP', {'id' : id} )) }}
                {% endblock %}
            </div>
            <br/>
            {{ form_start(form, {'attr': {'class': 'form-horizontal', 'id':'chat_form'}}) }}

            <div class="form-group">
                {{ form_label(form.Proposition, "Message", {'label_attr': {'class': 'col-sm-2 control-label'}}) }}
                {{ form_errors(form.Proposition) }}
                {{ form_widget(form.Proposition, {'attr' : {'class':'col-sm-10'}}) }}
            </div>
            <div class="form-inline">
                <div class="col-sm-11">
                    {{ form_widget(form.Envoyer, {'attr': {'class': 'btn btn-primary'}}) }}
                </div>
                {{ form_end(form) }}
            </div>

        {% endif %}
        <br/><br/>
    </div>
    {% block countdown %}
        <div style="position: fixed; margin-left: 1050px;" >
            <div class="wrap" style="position: fixed; margin-left: 1100px; margin-top: 80px">
                <h2>Temps restants</h2>
                <br/>
                <div class="countdown">
                    <div class="bloc-time hours" data-init-value="00">

                        <div class="figure hours hours-1">
                            <span class="top" style="">0</span>
                            <span class="top-back">
                            <span>0</span>
                        </span>
                            <span class="bottom" style="">0</span>
                            <span class="bottom-back">
                            <span>0</span>
                        </span>
                        </div>

                        <div class="figure hours hours-2">
                            <span class="top">0</span>
                            <span class="top-back">
                            <span>0</span>
                        </span>
                            <span class="bottom">0</span>
                            <span class="bottom-back">
                            <span>0</span>
                        </span>
                        </div>
                        <span class="count-title"><br/>Heures</span>

                    </div>

                    <div class="bloc-time min" data-init-value="0">

                        <div class="figure min min-1">
                            <span class="top">0</span>
                            <span class="top-back">
                            <span>0</span>
                        </span>
                            <span class="bottom">0</span>
                            <span class="bottom-back">
                            <span>0</span>
                        </span>
                        </div>

                        <div class="figure min min-2">
                            <span class="top">0</span>
                            <span class="top-back">
                            <span>0</span>
                        </span>
                            <span class="bottom">0</span>
                            <span class="bottom-back">
                            <span>0</span>
                        </span>
                        </div>
                        <span class="count-title">Minutes</span>
                    </div>

                    <div class="bloc-time sec" data-init-value="0">


                        <div class="figure sec sec-1">
                            <span class="top">0</span>
                            <span class="top-back">
                            <span>0</span>
                        </span>
                            <span class="bottom">0</span>
                            <span class="bottom-back">
                            <span>0</span>
                        </span>
                        </div>

                        <div class="figure sec sec-2">
                            <span class="top">0</span>
                            <span class="top-back">
                            <span>0</span>
                        </span>
                            <span class="bottom">0</span>
                            <span class="bottom-back">
                            <span>0</span>
                        </span>
                        </div>
                        <span class="count-title">Secondes</span>
                    </div>
                </div>
            </div>
        </div>
    {% endblock %}

    <div class="fixed-action-btn" style="margin-right: 23%">
        <div class="dropdown">
            <button class="mui-btn mui-btn--fab mui-btn--accent" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                ?
            </button>
            <div class="dropdown-menu help-toggle" aria-labelledby="dropdownMenuButton">
                <div style="margin-left: 10px; margin-right: 5px ">
                    {% block help %}
                        <p class="text-center">Discutez autour du probl√®me.</p>
                    {% endblock %}
                </div>
            </div>
        </div>
    </div>

{% endblock %}



{% block javascripts %}

    <script src="{{ asset('bundles/gdssplatform/js/jquery-3.3.1.min.js') }}"></script>
    <script src="{{ asset('bundles/gdssplatform/js/popper.min.js') }}"></script>
    <script src="{{ asset('bundles/gdssplatform/js/bootstrap.min.js') }}"></script>
    <script src="{{ asset('bundles/gdssphases/js/notify.js') }}"></script>
    <script src="{{ asset('bundles/gdssplatform/js/jQuery-plugin-progressbar.js') }}"></script>
    <script src="{{ asset('bundles/gdssphases/js/TweenMax.min.js') }}"></script>
    <script src="{{ asset('bundles/gdssplatform/js/mui.min.js') }}"></script>
    <script src="{{ asset('bundles/gdssplatform/js/materialize.min.js') }}"></script>
    <script src="{{ asset('bundles/fosjsrouting/js/router.min.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', { callback: 'fos.Router.setData' }) }}"></script>
    {% block customscript %}
    {% endblock %}
    <script>
        let id = {{ id }};
        {% if finish %}
            let hr = 0;
            let minu = 0;
            let sec = 0;
            let autorise = true;
        {% else %}
            let hr = {{ hours }};
            let minu = {{ minutes }};
            let sec = {{ seconds }};
            let autorise = true;
        {% endif %}

    </script>
    {% if finish == false %}
        <script src="{{ asset('bundles/gdssphases/js/timer.js') }}"></script>
    {% endif %}
    <script>

        {% if finish %}
        {% else %}

        $(function() {
            $('.fixed-action-btn').floatingActionButton();
        });
        $("document").ready(function () {

            element_b = document.getElementById('test');
            element_b.scrollTop = element_b.scrollHeight;
            let aut = false;
            let element = document.getElementById('test');

            $('#chat_form').on('submit', function (event) {
                event.preventDefault();
                setTimeout(y, 5000);
                let form_data = document.getElementById('form_Proposition').value;
                {% block customAjax %}
                    $.ajax({
                        url: Routing.generate('add_comp_chat', {'id' : id}),
                        type:"POST",
                        data: {proposition : form_data},
                        dataType: 'JSON',
                        success:function (data) {

                        }
                    });
                {% endblock %}
                document.getElementById('form_Proposition').value = '';
                element.scrollTop = element.scrollHeight;
            });





            let y = setInterval(function(){
                if(aut === true){
                    element.scrollTop = element.scrollHeight;
                    aut = false;
                }
                setTimeout(function(){
                    element = document.getElementById('test');
                    if(element.scrollHeight - element.scrollTop === element.clientHeight){
                        aut = true;
                    }
                }, 1000);
                {% block customLoad %}
                    $(".divscript").load(Routing.generate('scipts_comp', {'id' : id}),);
                {% endblock %}

            }, {% block interval %}5000{% endblock %});


            $('#stop').click(function () {
                clearInterval(y);
            });

            {% block customScrpit %}{% endblock %}


        });
        {% endif %}
    </script>
{% endblock %}
